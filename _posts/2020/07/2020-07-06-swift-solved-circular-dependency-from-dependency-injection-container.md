---
layout: post
title: "[iOS][Swift] 모듈간의 관계를 Dependency Injection Container으로 풀어보자 - Circular Dependency"
description: ""
category: "programming"
tags: [Swift, DI, Dependency Injection, Container, Circular Dependency, Protocol]
---
{% include JB/setup %}

## 모듈화 진행 과정 중 어려운 점

프로젝트가 커지면 전체적인 생산성이 감소합니다. 감소하는 이유로는 빠른 개발로 프로젝트 정리의 미진함, 레거시 코드의 발목 잡기, 방대한 양의 코드로 빌드 시간 증가, 테스트 코드 작성 시간 증가 등등이 있습니다.

이런 문제는 모듈화 작업으로 레거시 코드 정리 작업, 도메인별 코드 분리, 도메인별 테스트 코드 분리, 레거시 코드 정리을 할 수 있어 낮은 생산성을 끌어올릴 수 있습니다. 

하지만 운영중인 서비스에서는 이 작업이 쉽지는 않습니다. 그리고 기존 프로젝트는 분리하기 어렵지만 새로운 기능, 도메인에서는 모듈화를 하고 싶기도 합니다.

다양한 요구사항을 만족시킬 수 있는 방법은 있을까요?

사실 쉽지 않습니다. 

첫번째 예로, 카카오뱅크의 세이프박스라는 서비스를 만든다고 가정해봅시다. 세이프박스는 1천만원까지 금액을 별도의 계좌에 보관하고, 매일 이자가 붙는 상품입니다. 세이프박스에서 **금액을 입력**하고, **인증 비밀번호를 입력**하여 거래가 완료이 됩니다.

<p style="text-align:center;">
  <img src="{{ site.production_url }}/image/2020/07/20200706_1.png" style="width: 300px"/>
  <img src="{{ site.production_url }}/image/2020/07/20200706_2.png" style="width: 300px"/>
</p><br/>

이 서비스에서 금액 입력 등의 기본적인 기능까지는 새로운 모듈에서 작업을 하였습니다. 그러나 마지막 인증 비밀번호를 입력하는 기능은 아직 모듈화가 되지 않았습니다. 가장 핵심이 되는 기능을 붙이지 못해 서비스가 만들어지지 못합니다.

이런 경우는 어떻게 해야 할까요? 메인 프로젝트에서 세이프박스를 호출하니, 인증 기능을 Closure로 받아서 저장 후, 세이브 박스가 인증 Closure를 계속 가져다니다가 마지막에 처리하는 방식이 있습니다. 또는, 세이프박스가 Delegate 방식을 이용해서 인증 기능을 세이프박스 호출한 객체에서 인증 기능을 구현하여 해결할 수 있습니다.

여러모로 인증이라는 기능이 모듈로 분리되지 않아, 작업이 어렵습니다.

두번째 예로, 카카오뱅크의 카드 서비스에서는 **카드 관리**라는 화면이 있습니다. 여기에는 연결된 **입출금 통장의 관리 화면**으로 진입을 할 수 있습니다. 그리고 입출금 통장 관리에서는 **연결된 카드의 관리 화면**으로 진입할 수 있습니다.

<p style="text-align:center;">
  <img src="{{ site.production_url }}/image/2020/07/20200706_3.png" style="width: 300px"/>
  <img src="{{ site.production_url }}/image/2020/07/20200706_4.png" style="width: 300px"/>
</p><br/>

즉, **카드 관리 -> 입출금 통장 관리 -> 카드 관리 -> 입출금 통장 관리 -> 카드 관리 -> ...** 와 같은 과정이 생깁니다. 각 서비스들을 아직 모듈로 분리하지 않았다면 이런 과정이 가능합니다. 하지만, 카드 관리와 입출금 통장 관리 서비스가 모듈화로 분리되면 어떨까요?

<p style="text-align:center;">
    <img src="{{ site.production_url }}/image/2020/07/20200706_5.png" style="width: 400px"/>
</p><br/>
